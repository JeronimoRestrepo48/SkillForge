{% extends 'base.html' %}
{% load static %}

{% block title %}{{ certificacion.nombre }} - SkillForge{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'core:home' %}">Inicio</a></li>
            <li class="breadcrumb-item"><a href="{% url 'catalog:certificaciones_industria' %}">Certificaciones de industria</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ certificacion.nombre }}</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-4 mb-4">
            {% if certificacion.imagen %}
            <img src="{{ certificacion.imagen.url }}" class="img-fluid rounded-3 shadow-sm" alt="{{ certificacion.nombre }}" style="max-height: 300px; object-fit: cover; width: 100%;">
            {% elif certificacion.imagen_url %}
            <img src="{{ certificacion.imagen_url }}" class="img-fluid rounded-3 shadow-sm" alt="{{ certificacion.nombre }}" style="max-height: 300px; object-fit: cover; width: 100%;">
            {% else %}
            <div class="rounded-3 bg-dark text-light d-flex align-items-center justify-content-center" style="height: 300px;">
                <i class="bi bi-shield-check display-1"></i>
            </div>
            {% endif %}
            <div class="card mt-3">
                <div class="card-body">
                    <h5 class="card-title">Qué incluye</h5>
                    <ul class="small mb-0">
                        <li>Material de estudio completo (sin instructor)</li>
                        <li>Examen de 40 preguntas tipo cuestionario</li>
                        <li>Diploma PDF al aprobar (avalación de conocimientos)</li>
                    </ul>
                    {% if puede_acceder %}
                        {% if tiene_examen %}
                        <a href="{% url 'catalog:examen_certificacion' certificacion.slug %}" class="btn btn-skillforge w-100 mt-2">
                            <i class="bi bi-pencil-square"></i> Ir al examen
                        </a>
                        {% endif %}
                    {% else %}
                        <p class="fw-bold text-primary mt-2 mb-2">{{ certificacion.precio }} COP</p>
                        <form method="post" action="{% url 'transactions:cart_add_certificacion' certificacion.slug %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-skillforge w-100">Add to cart</button>
                        </form>
                        <p class="small text-muted mt-2 mb-0">After checkout you will have access to the material and exam. On passing you will receive your diploma.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <h1 class="h2 mb-3">{{ certificacion.nombre }}</h1>
            <div class="text-muted mb-4" style="white-space: pre-line;">{{ certificacion.descripcion }}</div>

            {% if not puede_acceder %}
            <div class="alert alert-warning">
                <strong>Acceso con pago.</strong> Para ver el material de estudio y realizar el examen certificado debes comprar el acceso a esta certificación. El diploma que obtienes al aprobar acredita avalación de conocimientos por la industria, no solo completitud de un curso.
            </div>
            {% else %}
            <h2 class="h5 mb-3">Material de estudio</h2>
            {% for seccion in secciones %}
            <div class="card mb-3">
                <div class="card-header bg-light">
                    <strong>{{ forloop.counter }}. {{ seccion.titulo }}</strong>
                </div>
                <div class="card-body">
                    <div style="white-space: pre-line;">{{ seccion.contenido }}</div>
                </div>
            </div>
            {% empty %}
            <p class="text-muted">No hay secciones de material publicadas.</p>
            {% endfor %}

            {% if tiene_examen %}
            <div class="mt-4 pt-3 border-top">
                <a href="{% url 'catalog:examen_certificacion' certificacion.slug %}" class="btn btn-skillforge btn-lg">
                    <i class="bi bi-pencil-square me-2"></i> Realizar examen
                </a>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
